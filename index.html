<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="keywords" content="JavaScript, ES6, functional, simpatico, minimalist, web verite">
  <meta name="author" content="Josh Rehman">
  <link id="favicon" rel="icon" type="image/png" href="./img/wizard-192x192.png"/>

  <title>Simpatico</title>
  <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
<h1>Simpatico</h1>
<p>javajosh <i>2023</i></p>

<p>
  Hi! If you're reading this in a browser with a localhost URL, congrats!
  You probably got here by doing something like this:
</p>

<pre>
  $ curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.3/install.sh | bash
  $ nvm install 18 && nvm use 18
  $ git clone https://github.com/javajosh/simpatico.git && cd simpatico
  $ npm install
  $ npm start
  [open browser with localhost address]
</pre>

<p>
  You are now looking at this file, <code>simpatico/index.html</code>.
  <i>ctrl-click</i> on the links below to open each module in a new tabs.

  (You can also look at them one by one.)
  Here they are, roughly in order of their dependencies:
</p>

<ol>
  <li><a href="core.html">core</a>
  <li><a href="combine.html">combine</a>
  <li><a href="rtree.html">rtree</a>
  <li><a href="friendly.html">friendly</a>
</ol>

<p>
  Each html file stands alone as a test harness for its corresponding component.
  core.html tests core.js, combine.html tests combine.js, etc.
  The file sources are themselves important, and designed to be read.
  Please consider the <i>page source</i> as an important part of the content.
</p>

<p>A brief description of what each does, from <code>readme.md</code>:</p>
<ol>
  <li>Core.
    Handy functions that smooth over the JavaScript runtime.
    Comprehensive predicates/assertions.
  <li>Combine.
    The function used to produce a new state from a previous state plus an input.
    A generalization of <code>Object.assign()</code> and previously known as "<a href="https://github.com/javajosh/combine-keys">combineKeys</a>".
  <li>RTree.
    A <a href="https://en.wikipedia.org/wiki/Trie">trie</a> data structure that organizes inputs into chains that result in different, related states.
    It is this structure that unifies previous distinct programming concepts like instantiation vs inheritance.
  <li>Friendly Function convention.
    A function takes a value and returns a result, possibly failing on bad values.
    A friendly function returns a description of which valid values are acceptable as a pattern.
  <li>(tentative) Normalized SVG coordinates.
    The basic authoring unit is the group ("g") containing a small number of path ("path") elts.
    Unique elements identified by string ID or by array id, which selects the Nth child recursively [3,5,11,0]
    Use a small, powerful side-effect primitive, <code>scatter(elt, obj)</code> which uses <code>elt.setAttribute(obj.key,
    obj.value)</code>.
  <li>(tentative) Board-game state convention.
    Express state only as updates to position of primitives, never creates or destroys elements.
    The state of the game is fully specified by the positions of the pieces on the board.
    A choice is a set of translations.
  <li>(ideas) html authoring; svg authoring; js binding to dom convention; 1+N process description convention; value key pair one value per line convention.
</ol>

<h3>Messages</h3>
<ol id="simpatico-messages">
  <li><label>Say something:<input type="text"></label></li>
  <li>:speaker > :message li created and appended</li>
</ol>

<script>
  console.log("Simpatico Front-End boot", "UTC", new Date().toUTCString(), "ms since epoch", Date.now(), window.location);

  const eltMessageList = document.getElementById("simpatico-messages");
  const host = window.location.hostname;
  const wsPort = 8081; //akwardly this needs to match reflector.js
  const url = `ws://${host}:${wsPort}/`;
  const conn = new WebSocket(url);
  conn.onopen = () => {
    conn.send('hey');
  }
  conn.onmessage = ({data}) => {
    const li = document.createElement("li");
    li.innerHTML = data;
    eltMessageList.appendChild(li);
  }
  document.body.onclick = e => {
    const elt = e.target;
    const tag = elt.tagName;
    if (tag !== 'a') return;
    const href = elt.href;
    const startsWithHttp = /^http/.test(href);
    console.log(elt, href, startsWithHttp);
    if (!startsWithHttp) {
      // do some fancy XHR stuff, and maybe set elt.innerHTML to the extracted body.
      // This works fine if you limit your links to be above and below the current node.
      // If the link is within the node, perhaps the content could be present astride that node, to the right of it.
      // For example by appending the node, but slipping it in the flow, and allowing the parent container to expand width.
      // Or more simply, to simply add the link contents to the string, somewhere useful.
    }
    return startsWithHttp;
  }
  document.body.onchange = e => {
    const msg = e.target.value;
    const connReady = conn !== undefined && conn.readyState === conn.OPEN;
    if (connReady) {
      conn.send(msg);
      console.log('msg sent', msg);
    }
  }

</script>

<p>
  Find out more about the structure of this file by reading <a href="notes/about_shell.html">About the Simpatico Shell</a>.
</p>

<style>
  svg > text {
    font-size: medium;
    font-family: "sans-serif";
    text-anchor: middle;
  }
  svg#unit-circle {
    background-color: #66b7ff;
    max-width: 800px;
  }
</style>
<svg id="unit-circle" class="natural-units"
     width="100%" height="100%"
     viewBox="-1 -1 2 2"
>
  <desc>Two squares moving around the unit circle and rotating, too, plus constantly changing text.</desc>
  <g transform="scale(1,-1)">
    <g id="green-square"  transform="translate(0,0)"  ><rect width=".2" height=".2" fill="#482" /></g>
    <g id="yellow-square" transform="translate(.1,.1)"><rect width=".2" height=".2" fill="#882" /></g>
    <g id="unit-circle"   transform="translate(0 ,0 )"><circle class='unit-circle' r="1" fill="none" stroke="red" stroke-width=".001 "/></g>
    <g id="some-text"     transform="translate(0,0)scale(.01,-.01)"><text>Scale and reflip text</text></g>
  </g>
</svg>

<script id="main" type="module">
  import {combine, rtree, svg, shuffle} from './simpatico.js';
  const $ = document.querySelectorAll.bind(document);

  // Kicking tires on rtree and combine
  window.r = rtree({});
  console.log(combine(1,1), r.residue());

  // Kicking tires on the display
  const greenSquare = $("#green-square")[0];
  const yellowSquare = $("#yellow-square")[0];
  const someText = $("#some-text")[0];
  svg.scatter(greenSquare, {x:-.75, y:-.75});

  const letters = 'abcdefghijklmnopqrstuvwxyz'.split('');
  // Doing a simple animation
  window.addEventListener('tick', e => {
    const t = e.detail.t;
    const {cos, sin} = Math;
    const C = 1/10000;

    svg.scatter(greenSquare, {x:cos(C*t), y:sin(C*t), rotate: t % 3600/10});
    svg.scatter(yellowSquare, {x:cos(-C*t), y:sin(-C*t), rotate: t % 3600/10});
    svg.scatter(someText, {x:-.9, y: 0, scale: ".008,-.008", text: shuffle(letters).join('')});
  });

</script>
<script id="module-tick" type="module">
  // Define a window.ontick custom event.
  // Usage: window.addEventListener('tick', e => console.log(e.detail.t));
  let n = 0;
  const throttle = 1;
  const tick = () => {
    if (window.ticking === false) return;
    if ((++n % throttle) === 0){
      const event = new CustomEvent('tick', {detail: {t: Date.now()}}); // See https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent/CustomEvent
      window.dispatchEvent(event);
    }
    window.requestAnimationFrame(tick);
  };
  tick();
</script>
</body>
</html>
