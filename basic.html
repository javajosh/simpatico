<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Basic</title>

    <link rel="stylesheet"
          data-href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"
          href="default.min.css">
    <script data-src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"
            src="highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
</head>
<body>
<p>Please open this file in the developer tools.</p>
<button onclick="start()">start</button>
<button onclick="stop()">stop</button>
<button onclick="reset()">reset</button>

<p>This file is a variant of a very basic loop:</p>
<pre><code>
    function handle(event) {
        state = combine(state, event);
        render(state);
    }
</code></pre>

<p>This is explored more fully in the readme. Here, the <code>render()</code> is just
    <code>console.log(state)</code>.
</p>
<script>
  let state = {};

  // Some handy predicates
  const number = o => typeof o === 'number';
  const string = o => typeof o === 'string';
  const fun = o => typeof o === 'function';
  const array = o => Array.isArray(o);
  const object = o => typeof o === 'object' && !array(o);

  const reducers = {
    // These reducers are good for numbers
    adder: (residue = 0, event) => residue + event,
    multiplier: (residue = 1, event) => residue * event,
    divider: (residue = 1e30, event) => residue / event,

    // This one is good for any type
    rememberer: (residue = [], event) => {
      const result = residue.slice();
      result.push(event);
      return result;
    }
  }

  // Reduce every member of residue, key-wise.
  const bigReduce = (reducers, residue, event) => {
    const result = {};
    for (let key in reducers) {
      result[key] = reducers[key](residue[key], event);
    }
    return result;
  }

  let throttle = 0;
  const combine = (state, event) => bigReduce(reducers, state, event)
  const render = (state) => {
    console.log(state)
  };
  const handle = (event) => {
    state = combine(state, event);
    render(state);
  }

  // Support for controls
  let timerId;
  const start = () => timerId = setInterval(() => handle(6), 50);
  const stop = () => clearInterval(timerId || 0);
  const reset = () => state = {};

</script>
</body>
</html>
