<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="keywords" content="JavaScript, ES6, functional, simpatico, minimalist, web verite">
  <meta name="author" content="javajosh">

  <!-- Begin testable.js html boilerplate; testable.js is in the same directory -->
  <link id="favicon" rel="icon" type="image/svg+xml" href="data:image/svg+xml,
  <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1 1'>
      <rect width='1' height='1' fill='white' />
  </svg>"/>
<!--  <meta id="refresh" http-equiv="refresh" content="2">-->
  <script src="testable.js"></script>
  <!-- End testable.js boilerplate  -->

  <title>svg.js</title>
  <link rel="stylesheet" type="text/css" href="style.css">
  <style>
    svg > text {
      font-size: medium;
      font-family: "sans-serif";
      text-anchor: middle;
    }
    svg {
      background-color: #66b7ff;
      max-width: 800px;
    }
  </style>
</head>
<body>

<h1>svg.js</h1>
<p>javajosh <i>2023</i></p>
<div class="makeItStop"></div>

<p>Scalable Vector Graphics, or SVG, is an important component of Simpatico.
  The browser also offers Canvas and WebGL, and of course DOM manipulation, as other ways to draw.
  We pick SVG and drive toward a state where <i>drawing</i> is done statically, and program state is characterized by a list of vectors interpreted to move these shapes.
  One particularly interesting application is drawing an <a href="/stree">stree</a> visualization, and then animating it under various conditions.
</p>
<p>
  Building up to that, we build up a few techniques
</p>
<p>First, an inline svg that uses a classical schoolroom coordinate system: the unit circle, (0,0) in the center, y up.
  Those new to programming graphics may be surprised that the standard way to program puts the origin at the top left with y increasing downward.
  This is a very good coordinate system if you want to always render text, starting from the upper left, and making a newline.
  This is how we write letters, school papers, and books, fiction and non-fiction.
  But <i>math</i> is usually taught on this particular coordinate system.
</p>
<ol>
  <li>The old system optimized for english text on highly resource constrained computers.
  Modern systems are vastly more powerful, allowing us to <i>start</i> from a more general primitive.</li>
  <li>Our primary target for graphics will be an inline svg in an html resource.</li>
  <li>SVG has several good features we want such as:
    <ol>
      <li>Object persistence. You can author a shape, or a group of shapes, and then move them around later.</li>
      <li>Arbitrary control over coordinate system - which we use to recover school math intuition</li>
    </ol>
  </li>
</ol>


<svg id="svg" class="natural-units"
     width="80%" height="100%"
     viewBox="-1 -1 2 2"
>
  <desc>Two squares moving around the unit circle and rotating, too, plus constantly changing text.</desc>
  <g transform="scale(1,-1)">
    <g id="green-square"  transform="translate(0,0)"  ><rect width=".2" height=".2" fill="#482" /></g>
    <g id="yellow-square" transform="translate(.1,.1)"><rect width=".2" height=".2" fill="#882" /></g>
    <g id="unit-circle"   transform="translate(0 ,0 )"><circle class='unit-circle' r="1" fill="none" stroke="red" stroke-width=".001 "/></g>
    <g id="some-text"     transform="translate(0,0)scale(.01,-.01)"><text>Scale and reflip text</text></g>
  </g>
</svg>

<p>Referencing an svg as an image:</p>
<img width="200px" src="/img/wizard.svg" alt="simpatico wizard" />

<p>Referencing an svg with built-in styles and javascript as an image, from :</p>
<img width="200px" src="/img/draggable.svg" alt="minimal draggable object demo" />
<p>To make the javascript work, you must right-click and "open image in new tab" where you can then interact (!) with it.</p>
<p>This technique was originally described by <a href="https://www.petercollingridge.co.uk/tutorials/svg/interactive/dragging/">Peter Collingridge</a></p>


<script id="animation" type="module">
  import {combine, rtree, svg, shuffle} from './simpatico.js';
  const $ = document.querySelectorAll.bind(document);

  // Kicking tires on stree and combine
  window.r = rtree({});
  console.log(combine(1, 1), r.residue());

  // Kicking tires on the display
  const greenSquare = $("#green-square")[0];
  const yellowSquare = $("#yellow-square")[0];
  const someText = $("#some-text")[0];
  svg.scatter(greenSquare, {x:-.75, y:-.75});

  const letters = 'abcdefghijklmnopqrstuvwxyz'.split('');
  // Doing a simple animation
  window.addEventListener('tick', e => {
    const t = e.detail.t;
    const {cos, sin} = Math;
    const C = 1/10000;

    svg.scatter(greenSquare, {x:cos(C*t), y:sin(C*t), rotate: t % 3600/10});
    svg.scatter(yellowSquare, {x:cos(-C*t), y:sin(-C*t), rotate: t % 3600/10});
    svg.scatter(someText, {x:-.9, y: 0, scale: ".008,-.008", text: shuffle(letters).join('')});
  });

</script>
<script id="module-tick" type="module">
  // Define a window.ontick custom event.
  // Usage: window.addEventListener('tick', e => console.log(e.detail.t));
  let n = 0;
  const throttle = 1;
  let animating = true;
  const tick = () => {
    if (window.ticking === false) return;
    if ((++n % throttle) === 0){
      const event = new CustomEvent('tick', {detail: {t: Date.now()}}); // See https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent/CustomEvent
      window.dispatchEvent(event);
    }
    if (animating) window.requestAnimationFrame(tick);
  };
  tick();
</script>
</body>
</html>
